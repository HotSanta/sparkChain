<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spark Chain - Fire-Centric Entrepreneurship</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            background: linear-gradient(to bottom, #0f1419 0%, #1a2332 30%, #2d1b0e 70%, #1a0f0a 100%);
            position: relative;
            overflow-x: hidden;
        }

        /* Forest background */
        #forest {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        .tree {
            position: absolute;
            bottom: 0;
        }

        .trunk {
            width: 30px;
            height: 120px;
            background: #3d2817;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .foliage {
            width: 0;
            height: 0;
            border-left: 60px solid transparent;
            border-right: 60px solid transparent;
            border-bottom: 150px solid #1a4d2e;
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Header */
        #header {
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 40px 20px;
            background: rgba(10, 14, 39, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 3px solid #ff6b35;
        }

        h1 {
            color: #ff6b35;
            font-size: 3em;
            text-shadow: 0 0 30px rgba(255, 107, 53, 0.7);
            margin-bottom: 10px;
        }

        #tagline {
            color: #ffa500;
            font-size: 1.2em;
            font-style: italic;
        }

        /* Main content */
        #content {
            position: relative;
            z-index: 10;
            padding: 40px 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        #add-idea-btn {
            background: linear-gradient(135deg, #ff6b35 0%, #ffa500 100%);
            border: none;
            color: white;
            padding: 20px 40px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.3em;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.5);
            transition: all 0.3s ease;
            display: block;
            margin: 0 auto 40px;
        }

        #add-idea-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(255, 107, 53, 0.7);
        }

        /* Sparks Grid */
        #sparks-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .spark-card {
            background: linear-gradient(135deg, rgba(26, 31, 58, 0.9) 0%, rgba(42, 24, 16, 0.9) 100%);
            border: 2px solid #ff6b35;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .spark-card::before {
            content: 'ðŸ”¥';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2em;
            opacity: 0.3;
        }

        .spark-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(255, 107, 53, 0.5);
            border-color: #ffa500;
        }

        .spark-title {
            color: #ff6b35;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }

        .spark-description {
            color: #ddd;
            font-size: 1em;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .comments-section {
            border-top: 2px solid rgba(255, 107, 53, 0.3);
            padding-top: 15px;
            margin-top: 15px;
        }

        .comments-header {
            color: #ffa500;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .comment {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            margin: 8px 0;
            border-left: 3px solid #ffa500;
            color: #ccc;
            font-size: 0.95em;
        }

        .comment-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ff6b35;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 0.95em;
            font-family: inherit;
            margin-top: 10px;
            resize: vertical;
            min-height: 60px;
        }

        .comment-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .comment-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.1);
            border-color: #ffa500;
        }

        .add-comment-btn {
            background: linear-gradient(135deg, #ff6b35 0%, #ffa500 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            margin-top: 8px;
            margin-right: 8px;
            transition: all 0.3s ease;
        }

        .add-comment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }

        .ai-comment-btn {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: bold;
            margin-top: 8px;
            transition: all 0.3s ease;
        }

        .ai-comment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1f3a 0%, #2a1810 100%);
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            border: 3px solid #ff6b35;
            box-shadow: 0 0 60px rgba(255, 107, 53, 0.4);
        }

        .modal-content h2 {
            color: #ff6b35;
            font-size: 2em;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 0 0 15px rgba(255, 107, 53, 0.5);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            color: #ffa500;
            font-size: 1.1em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ff6b35;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 1em;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.1);
            border-color: #ffa500;
            box-shadow: 0 0 15px rgba(255, 165, 0, 0.3);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 140px;
            padding: 15px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff6b35 0%, #ffa500 100%);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid #ff6b35;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
        }

        .success-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(40, 167, 69, 0.4);
            z-index: 2000;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .success-message.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .no-sparks {
            text-align: center;
            color: #ffa500;
            font-size: 1.5em;
            padding: 60px 20px;
        }

        .loading {
            text-align: center;
            color: #ffa500;
            font-size: 1.2em;
            padding: 40px;
        }
    </style>
</head>
<body>
    <!-- Forest background -->
    <div id="forest"></div>

    <!-- Header -->
    <div id="header">
        <h1>ðŸ”¥ Spark Chain</h1>
        <p id="tagline">The #1 Fire-Centric Site for Entrepreneurship</p>
    </div>

    <!-- Main content -->
    <div id="content">
        <button id="add-idea-btn">âœ¨ Ignite Your Idea</button>
        
        <div id="loading" class="loading">Loading sparks... ðŸ”¥</div>
        <div id="sparks-container" style="display: none;"></div>
    </div>

    <!-- Modal -->
    <div id="idea-modal" class="modal">
        <div class="modal-content">
            <h2>ðŸ”¥ Share Your Vision</h2>
            <div id="idea-form">
                <div class="form-group">
                    <label for="idea-title">Idea Title</label>
                    <input 
                        type="text" 
                        id="idea-title" 
                        placeholder="Enter your brilliant idea name..." 
                        maxlength="100"
                    >
                </div>
                <div class="form-group">
                    <label for="idea-description">Description</label>
                    <textarea 
                        id="idea-description" 
                        placeholder="Describe your entrepreneurial vision..."
                    ></textarea>
                </div>
                <div class="button-group">
                    <button type="button" class="btn btn-secondary" id="cancel-btn">Cancel</button>
                    <button type="button" class="btn btn-secondary" id="help-think-btn" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); border: none;">ðŸ¤– Help Me Think</button>
                    <button type="button" class="btn btn-primary" id="submit-btn">Ignite Spark ðŸ”¥</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success message -->
    <div id="success-message" class="success-message">
        âœ… Spark ignited successfully!
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, arrayUnion, onSnapshot, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAJcCHun8RxgVEum8HIxuDMyG4AzawY5g0",
            authDomain: "hknvidecodehack2025.firebaseapp.com",
            projectId: "hknvidecodehack2025",
            storageBucket: "hknvidecodehack2025.firebasestorage.app",
            messagingSenderId: "752015623667",
            appId: "1:752015623667:web:34663a05aa2d38c372be86"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Local sparks array
        let sparks = [];

        // Generate forest trees
        function generateForest() {
            const forest = document.getElementById('forest');
            const treeCount = 15;

            for (let i = 0; i < treeCount; i++) {
                const tree = document.createElement('div');
                tree.className = 'tree';
                tree.style.left = `${(i / treeCount) * 100 + Math.random() * 5}%`;
                tree.style.transform = `scale(${0.6 + Math.random() * 0.6})`;
                tree.style.opacity = 0.3 + Math.random() * 0.4;

                tree.innerHTML = `
                    <div class="trunk"></div>
                    <div class="foliage"></div>
                `;

                forest.appendChild(tree);
            }
        }

        // Load sparks from Firestore
        function loadSparksFromFirestore() {
            const sparksQuery = query(collection(db, 'userInputedIdeas'));
            
            onSnapshot(sparksQuery, (snapshot) => {
                sparks = [];
                snapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    sparks.push({
                        id: docSnap.id,
                        title: data.title || '',
                        description: data.description || '',
                        comments: data.comments || []
                    });
                });
                
                console.log('Loaded sparks from Firestore:', sparks);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('sparks-container').style.display = 'grid';
                renderSparks();
            }, (error) => {
                console.error('Error loading sparks:', error);
                document.getElementById('loading').textContent = 'Error loading sparks. Please check console.';
            });
        }

        // Render sparks
        function renderSparks() {
            const container = document.getElementById('sparks-container');
            container.innerHTML = '';

            if (sparks.length === 0) {
                container.innerHTML = '<div class="no-sparks">No sparks yet. Be the first to ignite one! ðŸ”¥</div>';
                return;
            }

            sparks.forEach(spark => {
                const sparkCard = document.createElement('div');
                sparkCard.className = 'spark-card';
                
                const commentsHTML = spark.comments.map(comment => 
                    `<div class="comment">${comment}</div>`
                ).join('');

                sparkCard.innerHTML = `
                    <div class="spark-title">${spark.title}</div>
                    <div class="spark-description">${spark.description}</div>
                    <div class="comments-section">
                        <div class="comments-header">
                            ðŸ’¬ Comments (${spark.comments.length})
                        </div>
                        ${commentsHTML}
                        <textarea 
                            class="comment-input" 
                            placeholder="Add your thoughts..."
                            data-spark-id="${spark.id}"
                        ></textarea>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="add-comment-btn" data-spark-id="${spark.id}">
                                Post Comment
                            </button>
                            <button class="ai-comment-btn" data-spark-id="${spark.id}">
                                ðŸ¤– AI Suggest
                            </button>
                        </div>
                    </div>
                `;

                container.appendChild(sparkCard);
            });

            // Add event listeners for comment buttons
            document.querySelectorAll('.add-comment-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const sparkId = e.target.dataset.sparkId;
                    const textarea = document.querySelector(`textarea[data-spark-id="${sparkId}"]`);
                    const commentText = textarea.value.trim();

                    if (!commentText) {
                        alert('Please enter a comment');
                        return;
                    }

                    await addCommentToFirestore(sparkId, commentText);
                    textarea.value = '';
                });
            });

            // Add event listeners for AI comment suggestion buttons
            document.querySelectorAll('.ai-comment-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const sparkId = e.target.dataset.sparkId;
                    const textarea = document.querySelector(`textarea[data-spark-id="${sparkId}"]`);
                    const spark = sparks.find(s => s.id === sparkId);
                    
                    if (spark) {
                        const aiComment = generateAIComment(spark);
                        textarea.value = aiComment;
                        
                        // Visual feedback
                        e.target.textContent = 'âœ¨ Suggested!';
                        setTimeout(() => {
                            e.target.textContent = 'ðŸ¤– AI Suggest';
                        }, 2000);
                    }
                });
            });
        }

        // AI comment generation
        function generateAIComment(spark) {
            const commentTemplates = [
                [
                    `This is a fascinating concept! Have you considered how ${spark.title.toLowerCase()} would handle scalability as it grows?`,
                    `I love the vision behind this. What's your go-to-market strategy for ${spark.title}?`,
                    `Great idea! How would you differentiate this from existing solutions in the market?`,
                    `This could really solve a pain point. What metrics would you track to measure success?`,
                    `Interesting approach! Have you validated this with potential customers yet?`
                ],
                [
                    `The potential here is huge! What technical challenges do you anticipate?`,
                    `This addresses a real need. How would you monetize ${spark.title}?`,
                    `Compelling idea! What's the estimated development timeline?`,
                    `I can see this working well. Have you thought about partnership opportunities?`,
                    `Smart concept! What would be your initial target demographic?`
                ],
                [
                    `Really innovative! How would you handle user onboarding to ensure adoption?`,
                    `This has potential. What regulatory challenges might you face?`,
                    `Thoughtful idea! Have you researched the competitive landscape?`,
                    `I'm intrigued. What would your revenue model look like?`,
                    `Great thinking! How would you acquire your first 1000 users?`
                ],
                [
                    `Solid concept! What key features would you prioritize for an MVP?`,
                    `This could work! Have you thought about the team you'd need to build this?`,
                    `Interesting angle! What resources would you need to get started?`,
                    `I see the value. How would you validate product-market fit?`,
                    `Nice idea! What's your unique value proposition compared to alternatives?`
                ]
            ];

            const categoryIndex = Math.floor(Math.random() * commentTemplates.length);
            const comments = commentTemplates[categoryIndex];
            const randomComment = comments[Math.floor(Math.random() * comments.length)];
            
            return randomComment;
        }

        // Add comment to Firestore
        async function addCommentToFirestore(sparkId, commentText) {
            try {
                const sparkRef = doc(db, 'userInputedIdeas', sparkId);
                await updateDoc(sparkRef, {
                    comments: arrayUnion(commentText)
                });

                console.log('Comment added to Firestore:', commentText);
                showSuccessMessage('ðŸ’¬ Comment added!');
            } catch (error) {
                console.error('Error adding comment:', error);
                alert('Error adding comment. Please try again.');
            }
        }

        // AI idea generation templates
        const aiIdeaTemplates = [
            {
                title: "Smart Home Energy Optimizer",
                description: "An AI-powered system that learns your energy usage patterns and automatically adjusts heating, cooling, and appliances to minimize costs while maintaining comfort. Includes predictive maintenance alerts and integration with renewable energy sources."
            },
            {
                title: "Mental Health Check-in App",
                description: "A daily mental wellness companion that uses mood tracking, journaling prompts, and evidence-based exercises. Connects users with licensed therapists when needed and provides personalized coping strategies based on patterns."
            },
            {
                title: "Skill-Swap Marketplace",
                description: "A platform where people can trade skills instead of money. Learn guitar from someone in exchange for teaching them photography. Includes time-banking, verification system, and community ratings."
            },
            {
                title: "Food Waste Prevention Network",
                description: "Connects restaurants and grocery stores with surplus food to local shelters, food banks, and community fridges. Real-time inventory updates, scheduled pickups, and impact tracking for donors."
            },
            {
                title: "Virtual Study Buddy Matcher",
                description: "Matches students studying similar subjects for virtual study sessions. Features include shared whiteboards, pomodoro timers, accountability tracking, and gamified progress milestones."
            },
            {
                title: "Neighborhood Tool Library",
                description: "A sharing economy platform for tools and equipment in local communities. Borrow a power drill, lawnmower, or ladder from neighbors. Includes insurance coverage, user ratings, and reservation system."
            },
            {
                title: "Career Pivot Coach AI",
                description: "An AI career advisor that analyzes your transferable skills and suggests viable career transitions. Includes personalized learning paths, industry insights, and connections to mentors in target fields."
            },
            {
                title: "Pet Health Monitoring Wearable",
                description: "A smart collar that tracks your pet's activity, sleep, and vital signs. Alerts you to potential health issues early and provides vet-approved wellness recommendations based on breed and age."
            }
        ];

        // Modal controls
        const modal = document.getElementById('idea-modal');
        const addBtn = document.getElementById('add-idea-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const submitBtn = document.getElementById('submit-btn');
        const helpThinkBtn = document.getElementById('help-think-btn');
        const successMessage = document.getElementById('success-message');

        addBtn.addEventListener('click', () => {
            modal.classList.add('active');
        });

        cancelBtn.addEventListener('click', () => {
            modal.classList.remove('active');
            document.getElementById('idea-title').value = '';
            document.getElementById('idea-description').value = '';
        });

        // Help Me Think button - generates AI idea
        helpThinkBtn.addEventListener('click', () => {
            const randomIdea = aiIdeaTemplates[Math.floor(Math.random() * aiIdeaTemplates.length)];
            
            document.getElementById('idea-title').value = randomIdea.title;
            document.getElementById('idea-description').value = randomIdea.description;
            
            console.log('AI generated idea:', randomIdea);
            
            // Visual feedback
            helpThinkBtn.textContent = 'âœ¨ Idea Generated!';
            setTimeout(() => {
                helpThinkBtn.textContent = 'ðŸ¤– Help Me Think';
            }, 2000);
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
                document.getElementById('idea-title').value = '';
                document.getElementById('idea-description').value = '';
            }
        });

        submitBtn.addEventListener('click', async () => {
            const title = document.getElementById('idea-title').value.trim();
            const description = document.getElementById('idea-description').value.trim();

            if (!title || !description) {
                alert('Please fill in all fields!');
                return;
            }

            try {
                // Add to Firestore
                await addDoc(collection(db, 'userInputedIdeas'), {
                    title: String(title),
                    description: String(description),
                    comments: []
                });

                console.log('New spark added to Firestore:', { title, description });

                modal.classList.remove('active');
                document.getElementById('idea-title').value = '';
                document.getElementById('idea-description').value = '';

                showSuccessMessage('âœ… Spark ignited successfully!');
            } catch (error) {
                console.error('Error adding spark:', error);
                alert('Error creating spark. Please try again.');
            }
        });

        function showSuccessMessage(message) {
            successMessage.textContent = message;
            successMessage.classList.add('active');
            setTimeout(() => {
                successMessage.classList.remove('active');
            }, 3000);
        }

        // Initialize
        generateForest();
        loadSparksFromFirestore();

        console.log('Spark Chain initialized with Firestore!');
    </script>
</body>
</html>